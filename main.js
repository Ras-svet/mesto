(()=>{"use strict";class e{constructor(e,t,s,n,r){this._addLike=r,this._personalId=n,this._cardId=e._id,this._ownerId=e.owner._id,this._likesNumber=e.likes,this._link=e.link,this._title=e.name,this._template=t,this._openFullScreen=s}_getTemplate(){return document.querySelector(this._template).content.querySelector(".element").cloneNode(!0)}_setEventListeners(){this._cardElement.querySelector(".element__trash").addEventListener("click",(()=>{this._deleteCard()})),this._cardElement.querySelector(".element__image").addEventListener("click",(()=>{this._openFullScreen(this._title,this._link)})),this._cardElement.querySelector(".element__like-button").addEventListener("click",(e=>{this._like(e)}))}_deleteCard(){this._cardElement.remove()}_like(e){e.target.classList.toggle("element__like-button_active"),this._cardElement=this._getTemplate(),this._likeContainer=this._cardElement.querySelector(".element__like-number"),this._addLike(this._cardId,this._likeContainer)}createCard(){return this._cardElement=this._getTemplate(),this._cardImage=this._cardElement.querySelector(".element__image"),this._cardElement.querySelector(".element__title").textContent=this._title,this._cardImage.src=this._link,this._cardImage.alt=this._title,this._setEventListeners(),this._cardElement}}class t{constructor(e,t){this._form=t,this._submitButton=e.submitButtonSelector,this._input=e.inputSelector,this._inputErr=e.inputErrorClass,this._buttonInactive=e.inactiveButtonClass,this._inputList=Array.from(this._form.querySelectorAll(this._input)),this._buttonElement=this._form.querySelector(this._submitButton)}_showInputError(e,t){const s=this._form.querySelector(`#${e.name}-error`);e.classList.add(this._inputErr),s.textContent=t}_hideInputError(e){this._form.querySelector(`#${e.name}-error`).textContent="",e.classList.remove(this._inputErr)}_checkInputValidity(e){e.validity.valid?this._hideInputError(e):this._showInputError(e,e.validationMessage)}_hasInvalidInput(){return this._inputList.some((e=>!e.validity.valid))}_enableButton(){this._buttonElement.classList.remove(this._buttonInactive),this._buttonElement.disabled=!1}_toggleButton(){this._hasInvalidInput()?this.disableButton():this._enableButton()}_setEventListeners(){this._inputList.forEach((e=>{e.addEventListener("input",(()=>{this._checkInputValidity(e),this._toggleButton()}))}))}disableButton(){this._buttonElement.classList.add(this._buttonInactive),this._buttonElement.disabled=!0}resetFormErrors(){this._inputList.forEach((e=>{this._hideInputError(e)}))}enableValidation(){this._form.addEventListener("submit",(function(e){e.preventDefault()})),this._setEventListeners()}}class s{constructor(e){this._popup=document.querySelector(e),this._handleEscClose=this._handleEscClose.bind(this),this._button=this._popup.querySelector(".popup__close-button")}_handleEscClose(e){"Escape"===e.key&&this.close()}_handleOverlayClose(e){e.target===e.currentTarget&&this.close()}setEventListeners(){this._popup.addEventListener("click",(e=>{this._handleOverlayClose(e)})),this._button.addEventListener("click",(()=>{this.close()}))}open(){this._popup.classList.add("popup_opened"),document.addEventListener("keydown",this._handleEscClose)}close(){this._popup.classList.remove("popup_opened"),document.removeEventListener("keydown",this._handleEscClose)}}class n extends s{constructor(e,t){super(e),this._handleForm=t,this._form=this._popup.querySelector(".popup__forms"),this._inputList=this._form.querySelectorAll(".popup__field")}_getInputValues(){const e={};return this._inputList.forEach((t=>{e[t.name]=t.value})),e}setEventListeners(){super.setEventListeners(),this._form.addEventListener("submit",(()=>{const e=this._getInputValues();this._handleForm(e),this.close()}))}close(){super.close(),this._form.reset()}}const r={inputSelector:".popup__field",submitButtonSelector:".popup__save-button",inactiveButtonClass:"popup__save-button_disabled",inputErrorClass:"popup__field_type_error"},i=document.querySelector(".popup_type_profile"),o=document.querySelector('[name="user-information"]'),l=o.querySelector(".popup__field_type_name"),_=o.querySelector(".popup__field_type_job"),a=document.querySelector(".profile__edit-button"),c=document.querySelector(".popup_type_card"),u=document.querySelector(".profile__add-button"),h=new class extends s{constructor(e){super(e),this._photo=this._popup.querySelector(".popup__picture"),this._title=this._popup.querySelector(".popup__text")}open(e,t){super.open(),this._photo.src=t,this._photo.alt=e,this._title.textContent=e}}(".popup_type_fullscreen");h.setEventListeners();const d=new n(".popup_type_card",(function(e){const t=b(e,"#element",L);v.addItem(t)}));d.setEventListeners();const p=new n(".popup_type_profile",(function(e){y.setUserInfo(e)}));p.setEventListeners();const m=new class{constructor({url:e,headers:t}){this._url=e,this._headers=t}_checkResponse(e){return e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`)}getUserInfo(){return fetch(`${this._url}/users/me`,{headers:this._headers}).then(this._checkResponse)}getCards(){return fetch(`${this._url}/cards`,{headers:this._headers}).then(this._checkResponse)}addLike(e){return fetch(`${this._url}/cards/${e}/likes`,{method:"PUT",headers:this._headers})}}({url:"https://mesto.nomoreparties.co/v1/cohort-74",headers:{authorization:"c55a96e6-da21-4263-9b88-67e69c11521a","Content-Type":"application/json"}});let E;Promise.all([m.getUserInfo(),m.getCards()]).then((([e,t])=>{y.setUserInfo(e),E=e._id,t.forEach((e=>{const t=b(e,"#element",L,E,f);v.addItem(t)}))}));const y=new class{constructor({nameSelector:e,jobSelector:t}){this._name=document.querySelector(e),this._job=document.querySelector(t)}getUserInfo(){return{name:this._name.textContent,job:this._job.textContent}}setUserInfo(e){this._name.textContent=e.name,this._job.textContent=e.about}}({nameSelector:".profile__name",jobSelector:".profile__job"});function b(t,s,n,r,i){return new e(t,s,n,r,i).createCard()}const v=new class{constructor({renderer:e},t){this._renderer=e,this._container=document.querySelector(t)}addItemByAppend(e){this._container.append(e)}addItem(e){this._container.prepend(e)}renderItems(e,t){Array.isArray(e)?e.forEach((e=>{this._renderer(e,t)})):this._renderer(e)}}({renderer:e=>{const t=b(e,"#element",L,E,f);v.addItemByAppend(t)}},".elements");function f(e,t){m.addLike(e).then((e=>{t.textContent=e.likes.length}))}function L(e,t){h.open(e,t)}const S=new t(r,i);S.enableValidation();const I=new t(r,c);I.enableValidation(),u.addEventListener("click",(e=>{d.open(),I.resetFormErrors(),I.disableButton()})),a.addEventListener("click",(()=>{const{name:e,job:t}=y.getUserInfo();l.value=e,_.value=t,p.open(),S.resetFormErrors(),S.disableButton()}))})();